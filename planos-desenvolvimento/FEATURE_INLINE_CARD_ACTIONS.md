# üöÄ Plano de Implementa√ß√£o: A√ß√µes Inline com `react-mentions` (`#label` e `@user`)

## 1. Vis√£o Geral

**Objetivo:** Implementar um sistema de autocompletar para etiquetas e utilizadores diretamente no campo de t√≠tulo do cart√£o **APENAS durante a cria√ß√£o** (n√£o na edi√ß√£o). Ao digitar `@` ou `#`, o utilizador poder√° selecionar um membro ou etiqueta para adicionar ao cart√£o, e o texto da men√ß√£o ser√° removido do t√≠tulo, mantendo-o limpo.

**Tecnologia-chave:** Utilizar a biblioteca `react-mentions`, que j√° est√° em uso na sec√ß√£o de coment√°rios, para garantir consist√™ncia visual e funcional.

**Funcionalidades:**
- **Autocompletar de Utilizadores:** Ao digitar `@` no t√≠tulo, um dropdown com os membros do quadro deve aparecer.
- **Autocompletar de Etiquetas:** Ao digitar `#`, um dropdown com as etiquetas do quadro deve ser apresentado.
- **Adi√ß√£o M√∫ltipla:** Permitir a adi√ß√£o de v√°rios utilizadores e v√°rias etiquetas no mesmo fluxo de cria√ß√£o.
- **Limpeza Autom√°tica:** Ap√≥s selecionar um utilizador ou etiqueta, o texto da men√ß√£o (ex: `@andre` ou `#bug`) deve ser removido automaticamente do campo de t√≠tulo.
- **Preview Visual:** Mostrar previews dos utilizadores e etiquetas adicionados na mesma posi√ß√£o e com as mesmas classes CSS que aparecem no cart√£o final, mantendo total consist√™ncia visual.
- **Suporte Completo de Utilizadores:** Funcionar tanto com nome (`user.name`) como com nome de utilizador (`user.username`), usando `user.name || user.username` como display.
- **Consist√™ncia de UI:** O design deve ser minimalista e integrado, e o dropdown de sugest√µes deve ser id√™ntico ao da sec√ß√£o de coment√°rios.
- **√Çmbito:** A funcionalidade ser√° implementada **APENAS** no campo de cria√ß√£o r√°pida de cart√£o na lista (`AddCard.jsx`). **N√ÉO ser√° implementada** no modal de edi√ß√£o do cart√£o (`NameField.jsx`).

## ‚ö†Ô∏è **STATUS ATUAL - AN√ÅLISE REAL**

**IMPORTANTE:** Ap√≥s an√°lise detalhada do c√≥digo, verificou-se que **a funcionalidade N√ÉO est√° implementada** nos componentes mencionados. O documento anterior continha afirma√ß√µes incorretas sobre o estado da implementa√ß√£o.

### ‚úÖ **O que REALMENTE est√° implementado:**
- Sistema de `react-mentions` funcional nos coment√°rios (`components/comments/Comments/Add.jsx`)
- A√ß√µes `addUserToCurrentCard(id)` e `addLabelToCurrentCard(id)` existem e funcionam
- Sagas para adicionar utilizadores/etiquetas a cart√µes existentes

### ‚ùå **O que N√ÉO est√° implementado (contr√°rio ao que estava documentado):**
- `AddCard.jsx` **n√£o tem** sistema de preview de utilizadores/etiquetas
- **N√£o existe** `usersToAdd` e `labelsToAdd` no estado local do `AddCard.jsx`
- Saga `createCard` **n√£o tem** l√≥gica para processar utilizadores/etiquetas durante a cria√ß√£o
- **N√£o existe** sistema de preview visual no campo de cria√ß√£o de cart√µes
- **Nota:** `NameField.jsx` (edi√ß√£o) **N√ÉO ser√° modificado** - funcionalidade apenas para cria√ß√£o

### ‚ö†Ô∏è **CONFLITOS IDENTIFICADOS COM A IMPLEMENTA√á√ÉO DO PLANKA:**

**1. Ordem de Prioridade dos Utilizadores:**
- **Planka usa:** `user.username || user.name` (username primeiro)
- **Documenta√ß√£o original:** `user.name || user.username` (name primeiro)
- **‚úÖ CORRE√á√ÉO:** Usar `user.username || user.name` para consist√™ncia

**2. Props do MentionsInput:**
- **Planka usa:** `appendSpaceOnAdd={true}` (com espa√ßo)
- **Documenta√ß√£o original:** `appendSpaceOnAdd={false}` (sem espa√ßo)
- **‚úÖ CORRE√á√ÉO:** Usar `appendSpaceOnAdd` conforme necess√°rio

**3. Estrutura de Callback:**
- **Planka usa:** `(_, text)` - ignora primeiro par√¢metro
- **Documenta√ß√£o original:** `(event, newValue, newPlainTextValue, mentions)` - todos os par√¢metros
- **‚úÖ CORRE√á√ÉO:** Usar estrutura do Planka para consist√™ncia

**4. Refs e Gest√£o de Estado:**
- **Planka usa:** `useRef` + `useNestedRef` + `useCallback`
- **Documenta√ß√£o original:** Apenas `useRef`
- **‚úÖ CORRE√á√ÉO:** Seguir padr√£o do Planka para compatibilidade

**5. üö® DESCOBERTA CR√çTICA - ClassName do MentionsInput:**
- **Coment√°rios (funcionam):** `className="mentions-input"` (classe global)
- **AddCard (n√£o funcionava):** `className={styles.field}` (CSS modules apenas)
- **‚úÖ SOLU√á√ÉO ENCONTRADA:** AddCard deve usar AMBAS as classes:
  ```jsx
  className={classNames(
    "mentions-input", // ‚Üê OBRIGAT√ìRIO para CSS global funcionar
    styles.field,     // ‚Üê CSS modules local
    isProcessing && styles.fieldProcessing
  )}
  ```
- **‚ö†Ô∏è PROBLEMA:** O CSS global `.mentions-input__suggestions` s√≥ se aplica quando a classe base `mentions-input` est√° presente
- **üîß SOLU√á√ÉO FINAL:** Usar `data-attributes` + JavaScript para isolamento perfeito entre AddCard e Coment√°rios

## 2. Estrat√©gia Central com `react-mentions`

O n√∫cleo da implementa√ß√£o ser√° um componente configurado `MentionsInput` que ser√° reutilizado, **aproveitando as funcionalidades j√° existentes** para adicionar utilizadores e etiquetas aos cart√µes.

### üìö **Configura√ß√£o T√©cnica do `react-mentions`**

**Importa√ß√£o necess√°ria:**
```javascript
import { MentionsInput, Mention } from 'react-mentions';
```

**Estrutura b√°sica do componente (baseada na implementa√ß√£o real do Planka):**
```javascript
<MentionsInput
  allowSpaceInQuery
  allowSuggestionsAboveCursor
  ref={mentionsRef}
  inputRef={inputRef}
  value={value}
  placeholder={placeholder}
  maxLength={1024}
  className="mentions-input"
  style={{
    control: {
      minHeight: '37px', // ou altura din√¢mica
    },
  }}
  onFocus={handleFocus}
  onChange={handleChange}
  onKeyDown={handleKeyDown}
>
  <Mention
    trigger="@"
    appendSpaceOnAdd
    data={usersData}
    displayTransform={(_, display) => `@${display}`}
    renderSuggestion={suggestionRenderer}
    onAdd={handleUserAdd}
    className={styles.mention}
  />
  <Mention
    trigger="#"
    appendSpaceOnAdd
    data={labelsData}
    displayTransform={(_, display) => `#${display}`}
    renderSuggestion={renderLabelSuggestion}
    onAdd={handleLabelAdd}
    className={styles.mention}
  />
</MentionsInput>
```

**Props importantes do `MentionsInput`:**
- `value`: String com o valor atual do campo
- `onChange`: Fun√ß√£o callback `(event, newValue, newPlainTextValue, mentions)`
- `className`: Classe CSS para estiliza√ß√£o
- `style`: Estilos inline para o componente
- `allowSpaceInQuery`: `true` para permitir espa√ßos na busca
- `allowSuggestionsAboveCursor`: `true` para mostrar sugest√µes acima se necess√°rio

**Props importantes do `Mention`:**
- `trigger`: String ou regex para ativar (`"@"` ou `"#"`)
- `data`: Array de objetos com `{id, display}` ou fun√ß√£o de busca
- `renderSuggestion`: Fun√ß√£o para renderizar cada sugest√£o
- `onAdd`: Callback quando uma sugest√£o √© selecionada
- `appendSpaceOnAdd`: `false` para n√£o adicionar espa√ßo automaticamente
- `displayTransform`: Fun√ß√£o para transformar o display final

### üîß **Estrutura de Dados e Fontes**

- **Fontes de Dados:**
  - **Utilizadores:** A lista de membros do quadro ser√° obtida do estado do Redux (`selectors.selectMembershipsForCurrentBoard`). Apenas os utilizadores dispon√≠veis ser√£o mostrados.
  - **Etiquetas:** A lista de etiquetas vir√° do Redux (`selectors.selectLabelsForCurrentBoard`).

- **Gatilhos (`Mention`):**
  - `<Mention trigger="@" ... />` para utilizadores.
  - `<Mention trigger="#" ... />` para etiquetas.

- **L√≥gica de Adi√ß√£o (`onAdd`):** **IMPLEMENTAR APENAS PARA CRIA√á√ÉO:**
  1. **Para Cria√ß√£o de Cart√£o (`AddCard.jsx`):** **IMPLEMENTAR NOVO SISTEMA** com `usersToAdd` e `labelsToAdd` no estado local, que ser√£o processados ap√≥s a cria√ß√£o do cart√£o.
  2. **Limpeza do Texto:** Ap√≥s selecionar um item, remover automaticamente o texto da men√ß√£o do campo de t√≠tulo.
  3. **Nota:** Edi√ß√£o de cart√µes (`NameField.jsx`) **N√ÉO ser√° modificada** - funcionalidade apenas para cria√ß√£o.

- **Vantagens desta Abordagem:**
  - **Consist√™ncia:** Usa exatamente as mesmas a√ß√µes e fluxos que j√° existem no sistema.
  - **Manutenibilidade:** N√£o duplica l√≥gica, aproveita o que j√° est√° testado e funcional.
  - **Simplicidade:** Menos c√≥digo para manter e menos pontos de falha.

### üé® **DESCOBERTA FINAL: Solu√ß√£o Completa para Glass Effect Isolado**

**‚ö†Ô∏è PROBLEMA IDENTIFICADO:** Conseguir aplicar glass effect apenas no AddCard sem afetar coment√°rios era extremamente complexo devido √† estrutura do react-mentions.

**‚úÖ SOLU√á√ÉO IMPLEMENTADA COM SUCESSO:**

#### **üîç Passos da Solu√ß√£o Final (TESTADA E FUNCIONANDO):**

**Passo 1: Corrigir className no AddCard.jsx**
```jsx
// ANTES (n√£o funcionava):
className={classNames(styles.field, isProcessing && styles.fieldProcessing)}

// DEPOIS (funciona):
className={classNames(
  "mentions-input", // ‚Üê CR√çTICO: classe global obrigat√≥ria
  styles.field,     // ‚Üê CSS modules local
  isProcessing && styles.fieldProcessing
)}
```

**Passo 2: Adicionar identificador √∫nico ao AddCard**
```jsx
<div {...clickAwayProps} ref={nameFieldRef} 
     className={styles.mentionsWrapper} 
     data-mentions-context="add-card">  // ‚Üê Identificador √∫nico
```

**Passo 3: JavaScript para isolamento autom√°tico**
```jsx
useEffect(() => {
  const observer = new MutationObserver(() => {
    const dropdowns = document.querySelectorAll('.mentions-input__suggestions');
    dropdowns.forEach(dropdown => {
      const isInAddCard = dropdown.closest('[data-mentions-context="add-card"]');
      if (isInAddCard) {
        dropdown.setAttribute('data-add-card-dropdown', 'true');
        // Marca tamb√©m os itens
        const items = dropdown.querySelectorAll('.mentions-input__suggestions__item');
        items.forEach(item => item.classList.add('suggestions-item-add-card'));
      }
    });
  });
  observer.observe(document.body, { childList: true, subtree: true });
}, []);
```

**Passo 4: CSS isolado com exclus√µes**
```scss
// CSS para coment√°rios (exclui AddCard):
.mentions-input {
  &__suggestions:not([data-add-card-dropdown="true"]) {
    // Estilo original dos coment√°rios
  }
  &__item:not(.suggestions-item-add-card) {
    // Estilo original dos coment√°rios
  }
}

// CSS exclusivo para AddCard:
[data-mentions-context="add-card"] .mentions-input__suggestions,
.mentions-input__suggestions[data-add-card-dropdown="true"] {
  // Glass effect especial para AddCard
  background: rgba(14, 17, 23, 0.95) !important;
  backdrop-filter: blur(20px) !important;
  // ... estilos √∫nicos
}
```

#### **üéØ Resultado Final:**
- ‚úÖ **AddCard:** Glass theme espec√≠fico e diferenciado
- ‚úÖ **Coment√°rios:** Tema original preservado sem altera√ß√µes
- ‚úÖ **Isolamento Total:** Zero interfer√™ncia entre contextos
- ‚úÖ **Auto-aplica√ß√£o:** Funciona automaticamente via JavaScript Observer

#### **üîç An√°lise da Implementa√ß√£o Original (ATUALIZADA):**

**1. Diferen√ßa entre Coment√°rios vs Cria√ß√£o de Cart√£o:**
- **Coment√°rios:** Usam `className="mentions-input"` (classe global)
- **AddCard:** DEVE usar `className="mentions-input"` + classes locais (DESCOBERTA CR√çTICA)

**2. Estrutura Correta do MentionsInput:**
```jsx
// AddCard.jsx - IMPLEMENTA√á√ÉO CORRETA
<MentionsInput
  allowSpaceInQuery
  allowSuggestionsAboveCursor
  ref={nameMentionsRef}
  inputRef={nameInputRef}
  value={data.name}
  placeholder={t('common.enterCardTitle')}
  maxLength={1024}
  className="mentions-input"  // ‚Üê CHAVE: Classe global (n√£o CSS modules)
  style={{
    control: {
      minHeight: '32px',  // ‚Üê Apenas estilos b√°sicos necess√°rios
    },
  }}
>
  <Mention
    trigger="@"
    appendSpaceOnAdd
    data={usersData}
    displayTransform={(_, display) => `@${display}`}
    renderSuggestion={suggestionRenderer}
    onAdd={handleUserAdd}
    // ‚Üê SEM className aqui (diferente dos coment√°rios)
  />
  <Mention
    trigger="#"
    appendSpaceOnAdd
    data={labelsData}
    displayTransform={(_, display) => `#${display}`}
    renderSuggestion={renderLabelSuggestion}
    onAdd={handleLabelAdd}
    // ‚Üê SEM className aqui
  />
</MentionsInput>
```

#### **3. CSS Global para Glass Effect (styles.module.scss):**

**Estrat√©gia de Seletores com M√°xima Especificidade:**
```scss
// Seletores m√∫ltiplos para garantir aplica√ß√£o
[class*="mentions-input__suggestions"],
.mentions-input__suggestions,
div[class*="mentions-input__suggestions"],
html .mentions-input__suggestions,
body .mentions-input__suggestions,
#app .mentions-input__suggestions {
  // Glass Effect Moderno
  background: rgba(14, 17, 23, 0.95) !important;
  backdrop-filter: blur(24px) !important;
  -webkit-backdrop-filter: blur(24px) !important;
  -moz-backdrop-filter: blur(24px) !important;
  border: 1px solid rgba(255, 255, 255, 0.12) !important;
  border-radius: 16px !important;
  box-shadow: 
    0 20px 40px rgba(0, 0, 0, 0.7) !important,
    0 8px 16px rgba(0, 0, 0, 0.5) !important,
    inset 0 1px 0 rgba(255, 255, 255, 0.15) !important;
  z-index: 100020 !important;
  padding: 12px !important;
  margin-top: 8px !important;
  max-height: 250px !important;
  overflow-y: auto !important;
  color: rgba(230, 237, 243, 0.9) !important;
}

// Itens do dropdown
[class*="mentions-input__suggestions__item"],
.mentions-input__suggestions__item,
div[class*="mentions-input__suggestions__item"],
html .mentions-input__suggestions__item,
body .mentions-input__suggestions__item,
#app .mentions-input__suggestions__item {
  background: transparent !important;
  color: rgba(230, 237, 243, 0.85) !important;
  padding: 12px 16px !important;
  border-radius: 10px !important;
  margin: 2px 0 !important;
  transition: all 0.2s ease !important;
  cursor: pointer !important;
  
  &:hover {
    background: rgba(59, 130, 246, 0.12) !important;
    color: #ffffff !important;
  }
}

// Estado focused
[class*="mentions-input__suggestions__item--focused"],
.mentions-input__suggestions__item--focused,
div[class*="mentions-input__suggestions__item--focused"],
html .mentions-input__suggestions__item--focused,
body .mentions-input__suggestions__item--focused,
#app .mentions-input__suggestions__item--focused {
  background: rgba(59, 130, 246, 0.25) !important;
  color: #ffffff !important;
  box-shadow: 
    0 4px 12px rgba(59, 130, 246, 0.3) !important,
    inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
}
```

#### **4. JavaScript Backup (Opcional - AddCard.jsx):**

**Para garantir aplica√ß√£o em casos extremos:**
```jsx
// Force glass effect via JavaScript (backup)
useEffect(() => {
  const applyGlassEffect = () => {
    const dropdowns = document.querySelectorAll('.mentions-input__suggestions');
    dropdowns.forEach(dropdown => {
      dropdown.style.cssText = `
        background: rgba(14, 17, 23, 0.95) !important;
        backdrop-filter: blur(24px) !important;
        border: 1px solid rgba(255, 255, 255, 0.12) !important;
        border-radius: 16px !important;
        // ... outros estilos
      `;
    });
  };

  const observer = new MutationObserver(() => applyGlassEffect());
  observer.observe(document.body, { childList: true, subtree: true });
  applyGlassEffect();

  return () => observer.disconnect();
}, []);
```

#### **5. Pontos Cr√≠ticos para Sucesso:**

**‚úÖ O que FUNCIONA:**
- Usar `className="mentions-input"` (classe global)
- CSS com m√∫ltiplos seletores e `!important`
- Estrutura id√™ntica aos coment√°rios (que j√° funcionam)

**‚ùå O que N√ÉO funciona:**
- `className={styles.field}` (CSS modules)
- Estilos inline complexos no `MentionsInput`
- Seletores CSS sem especificidade suficiente

**üéØ Resultado:** Dropdown com glass effect moderno apenas na cria√ß√£o de cart√£o, sem afetar coment√°rios.

### üé® **Estiliza√ß√£o e Temas**

**Baseado no sistema existente dos coment√°rios:**
- Usar as mesmas classes CSS do sistema de coment√°rios (`components/comments/Comments/Add.jsx`)
- Aplicar tema glass effect consistente com o resto da aplica√ß√£o
- Manter z-index adequado para aparecer por cima de outros elementos

**Estrutura de dados para utilizadores (baseada na implementa√ß√£o real do Planka):**
```javascript
const usersData = boardMemberships.map(({ user }) => ({
  id: user.id,
  display: user.username || user.name, // ‚ö†Ô∏è ORDEM INVERTIDA: username primeiro, como no Planka
}));
```

**Estrutura de dados para etiquetas:**
```javascript
const labelsData = labels.map(label => ({
  id: label.id,
  display: label.name,
  color: label.color
}));
```

**Fun√ß√µes de renderiza√ß√£o (baseadas na implementa√ß√£o real do Planka):**
```javascript
// ‚ö†Ô∏è IMPORTANTE: Usar exatamente a mesma estrutura do sistema de coment√°rios
const suggestionRenderer = useCallback(
  (entry, _, highlightedDisplay) => (
    <div className={styles.suggestion}>
      <UserAvatar id={entry.id} size="tiny" />
      {highlightedDisplay}
    </div>
  ),
  []
);

// Para etiquetas (nova implementa√ß√£o):
const renderLabelSuggestion = useCallback(
  (entry, search, highlightedDisplay) => (
    <div className={styles.suggestion}>
      <LabelChip id={entry.id} size="tiny" />
      {highlightedDisplay}
    </div>
  ),
  []
);
```

**Callbacks de adi√ß√£o:**
```javascript
const handleUserAdd = (id, display, startPos, endPos) => {
  // Para NameField: dispatch(entryActions.addUserToCurrentCard(id));
  // Para AddCard: adicionar ao usersToAdd array
  // Limpar texto da men√ß√£o do campo
};

const handleLabelAdd = (id, display, startPos, endPos) => {
  // Para NameField: dispatch(entryActions.addLabelToCurrentCard(id));
  // Para AddCard: adicionar ao labelsToAdd array
  // Limpar texto da men√ß√£o do campo
};
```

## 3. Plano de Implementa√ß√£o Detalhado

### Passo 1: Prepara√ß√£o e Limpeza
- **A√ß√£o:** Verificar que o ficheiro `AddCard.jsx` est√° limpo e pronto para implementa√ß√£o.
- **Nota:** `NameField.jsx` (edi√ß√£o) **N√ÉO ser√° modificado** - funcionalidade apenas para cria√ß√£o.

### Passo 2: Implementa√ß√£o na Cria√ß√£o de Cart√£o (`AddCard.jsx`)

1.  **Estado Local:** **IMPLEMENTAR NOVO SISTEMA:**
    - **Criar** `usersToAdd` e `labelsToAdd` no estado local.
    - **Implementar** sistema para passar estes dados para a saga `createCard`.
2.  **Integra√ß√£o do `MentionsInput`:** **IMPLEMENTAR** - Substituir o `TextareaAutosize` pelo `MentionsInput`, aplicando os estilos existentes.
3.  **Estrutura de Dados dos Utilizadores:** **IMPLEMENTAR - GARANTIR SUPORTE COMPLETO:**
    - **Display:** Usar `user.username || user.name` para consist√™ncia com o sistema existente (username primeiro).
    - **Dados do Mention:** Incluir tanto `name` como `username` para permitir busca por ambos.
    - **Renderiza√ß√£o:** Mostrar username principal e name secund√°rio (se diferente) no dropdown.
4.  **Implementar `onAdd` - IMPLEMENTAR NOVA L√ìGICA:**
    - **Para Utilizadores:** Adicionar o ID ao array `usersToAdd` (implementar).
    - **Para Etiquetas:** Adicionar o ID ao array `labelsToAdd` (implementar).
    - **Limpeza do Texto:** Remover o texto da men√ß√£o do campo `name` (implementar).
5.  **Preview Visual - ESTRUTURA DEFINIDA BASEADA NO PLANKA:**
    - **Localiza√ß√£o:** O preview deve aparecer **dentro do `.fieldWrapper`** (linha 264-274) logo **ANTES** do campo de texto.
    - **Estrutura dos Previews:**
      
      **üè∑Ô∏è Labels (Etiquetas) - FICAM NO TOPO, ALINHADOS √Ä ESQUERDA:**
      ```jsx
      {labelsToAdd.length > 0 && (
        <div className={styles.previewLabels}>
          {labelsToAdd.map(labelId => (
            <span key={labelId} className={classNames(styles.previewAttachment, styles.previewAttachmentLeft)}>
              <LabelChip id={labelId} size="tiny" />
            </span>
          ))}
        </div>
      )}
      ```
      
      **üë• Utilizadores - FICAM NO TOPO, ALINHADOS √Ä DIREITA (float: right):**
      ```jsx
      {usersToAdd.length > 0 && (
        <div className={classNames(styles.previewAttachments, styles.previewAttachmentsRight)}>
          {usersToAdd.map(userId => (
            <span key={userId} className={classNames(styles.previewAttachment, styles.previewAttachmentRight)}>
              <UserAvatar id={userId} size="small" />
            </span>
          ))}
        </div>
      )}
      ```
    
    - **Classes CSS a Adicionar ao `AddCard.module.scss`:**
      ```scss
      .previewAttachment {
        display: inline-block;
        line-height: 0;
        margin: 0 0 6px 0;
        max-width: 100%;
        vertical-align: top;
      }
      
      .previewAttachmentLeft {
        margin-right: 4px;
      }
      
      .previewAttachmentRight {
        margin-left: 2px;
      }
      
      .previewAttachments {
        display: inline-block;
        padding-bottom: 2px;
      }
      
      .previewAttachmentsRight {
        float: right;
        line-height: 0;
        margin-top: 6px;
      }
      
      .previewLabels {
        max-width: 100%;
        overflow: hidden;
        margin-bottom: 4px;
      }
      
      // Clearfix para garantir layout correto com float
      .fieldWrapper:after {
        clear: both;
        content: "";
        display: table;
      }
      ```
    
    - **Posicionamento:** 
      - Labels ficam numa linha pr√≥pria no topo, alinhados √† esquerda
      - Utilizadores ficam numa linha pr√≥pria no topo, alinhados √† direita (float)
      - Campo de texto fica por baixo dos previews
      - **Exatamente como nos cart√µes do Planka** - mesma estrutura visual
6.  **Tema Glass Effect - ESPECIFICA√á√ÉO EXATA BASEADA NO PROJETO:**
    
    **üìç Localiza√ß√£o:** Os estilos j√° existem em `client/src/styles.module.scss` (linhas 79-102).
    
    **üé® Estilos Atuais do Dropdown (a substituir):**
    ```scss
    // ATUAL em styles.module.scss (linhas 85-101)
    .mentions-input {
      &__suggestions {
        border: 1px solid #d4d4d5;
        border-radius: 3px;
        box-shadow: 0 8px 16px -4px rgba(9, 45, 66, 0.25);
        max-height: 200px;
        overflow-y: auto;
        
        &__item {
          padding: 8px 12px;
          &--focused {
            background-color: rgba(0, 0, 0, 0.05);
            color: rgba(0, 0, 0, 0.95);
          }
        }
      }
    }
    ```
    
    **‚ú® Novos Estilos Glass Theme (a implementar):**
    ```scss
    // NOVO - Glass Theme para mentions dropdown
    .mentions-input {
      &__highlighter {
        line-height: 1.4;
        padding: 8px 12px;
      }

      &__suggestions {
        // Glass Effect baseado no glass-theme.css
        background: rgba(var(--glass-bg-rgb), 0.85) !important;
        -webkit-backdrop-filter: blur(16px);
        backdrop-filter: blur(16px);
        border: 1px solid var(--glass-border);
        border-radius: 16px; // Consistente com modais glass
        box-shadow: var(--glass-shadow);
        max-height: 200px;
        overflow-y: auto;
        z-index: 100020; // Acima de todos os elementos
        
        // Scroll glass theme
        &::-webkit-scrollbar {
          width: 8px;
        }
        
        &::-webkit-scrollbar-thumb {
          border-radius: 4px;
          background: linear-gradient(
            180deg,
            rgba(59, 130, 246, 0.45),
            rgba(29, 78, 216, 0.45)
          );
        }

        &__item {
          padding: 8px 12px;
          color: var(--text-secondary);
          transition: all 0.2s ease;
          
          &--focused {
            background: rgba(59, 130, 246, 0.15);
            color: var(--text-primary);
            border-radius: 8px;
            margin: 2px 4px;
          }
        }
      }
    }
    ```
    
    **‚ö†Ô∏è VARI√ÅVEIS CSS NECESS√ÅRIAS:**
    As vari√°veis j√° existem em `glass-theme.css`:
    - `--glass-bg-rgb: 14, 17, 23`
    - `--glass-border: rgba(255, 255, 255, 0.06)`
    - `--glass-shadow: 0 14px 34px rgba(0, 0, 0, 0.55)`
    - `--text-primary: #e6edf3`
    - `--text-secondary: rgba(230, 237, 243, 0.75)`
    
    **üîß IMPLEMENTA√á√ÉO:**
    1. **Substituir** os estilos atuais em `styles.module.scss` (linhas 85-101)
    2. **Aplicar** os novos estilos glass theme
    3. **Testar** que o dropdown aparece com o efeito glass correto
7.  **L√≥gica de Submiss√£o:** **IMPLEMENTAR NOVA L√ìGICA:**
    - **Modificar** a saga `createCard` para processar `userIds` e `labelIds`.
    - **Implementar** sistema para despachar as a√ß√µes `addUserToCard` e `addLabelToCard` ap√≥s a cria√ß√£o.
    - **‚ö†Ô∏è IMPORTANTE:** Usar as **mesmas a√ß√µes Redux** que o sistema de edi√ß√£o usa, garantindo total compatibilidade.

8.  **Compatibilidade com Sistema Existente:**
    - **Garantir** que as a√ß√µes `addUserToCurrentCard` e `addLabelToCurrentCard` continuem funcionando normalmente.
    - **Manter** os popups de sele√ß√£o de utilizadores/etiquetas no modal de edi√ß√£o funcionais.
    - **Sincronizar** o estado entre cria√ß√£o (men√ß√µes) e edi√ß√£o (popups) para consist√™ncia total.

---
### **Pausa para Testes ‚è∏Ô∏è: Verifica√ß√£o da Cria√ß√£o de Cart√µes**
**Objetivo:** Validar o fluxo de cria√ß√£o de cart√µes de ponta a ponta.
- **Teste 1:** O layout da coluna e do formul√°rio de cria√ß√£o deve estar intacto.
- **Teste 2:** Digitar um t√≠tulo com `@`. A lista de utilizadores deve aparecer e estar **vis√≠vel**.
- **Teste 3:** Selecionar um utilizador e uma etiqueta. Os textos das men√ß√µes devem desaparecer.
- **Teste 4:** **Suporte de Utilizadores:** Testar com utilizadores que t√™m apenas `name`, apenas `username`, e ambos os campos.
- **Teste 5:** **Tema Glass Effect:** Verificar se o dropdown de sugest√µes tem o tema glass effect aplicado (fundo transl√∫cido com blur, bordas glass, sombras).
- **Teste 6:** **Posicionamento dos Previews:** 
  - Labels devem aparecer no topo, alinhados √† esquerda
  - Utilizadores devem aparecer no topo, alinhados √† direita (float: right)
  - Campo de texto deve ficar por baixo dos previews
  - Layout deve ser id√™ntico aos cart√µes normais do Planka
- **Teste 7:** Clicar em "Adicionar Cart√£o".
- **Teste 8:** Verificar se o cart√£o foi criado com o t√≠tulo correto (sem as men√ß√µes) e se o utilizador e a etiqueta selecionados foram corretamente associados a ele.
- **Teste 9:** Adicionar um cart√£o sem men√ß√µes para garantir que o fluxo normal n√£o foi afetado.
- **Teste 10:** **Verificar que a edi√ß√£o de cart√µes N√ÉO foi afetada** - abrir um cart√£o existente e verificar que o campo de t√≠tulo funciona normalmente (sem men√ß√µes).
- **Teste 11:** **Verificar funcionalidades existentes de edi√ß√£o:**
  - Clicar no bot√£o "Membros" no modal de edi√ß√£o - deve funcionar normalmente
  - Clicar no bot√£o "Etiquetas" no modal de edi√ß√£o - deve funcionar normalmente
  - Adicionar/remover utilizadores via edi√ß√£o - deve funcionar normalmente
  - Adicionar/remover etiquetas via edi√ß√£o - deve funcionar normalmente
- **Teste 12:** **Verificar sintonia entre cria√ß√£o e edi√ß√£o:**
  - Criar um cart√£o com men√ß√µes `@user` e `#label`
  - Abrir o cart√£o criado e verificar que os utilizadores/etiquetas aparecem nos bot√µes de edi√ß√£o
  - Adicionar mais utilizadores/etiquetas via edi√ß√£o
  - Verificar que tudo aparece consistentemente no cart√£o

### **üî¨ TESTES DE EDGE CASES (CR√çTICOS):**
- **Teste Edge 1:** **Caracteres Especiais:** Digitar `@@`, `##`, `@#`, `#@` - dropdown deve aparecer apenas no √∫ltimo caractere
- **Teste Edge 2:** **Performance:** Criar quadro com 50+ utilizadores e 20+ labels - dropdown deve aparecer rapidamente
- **Teste Edge 3:** **Texto Longo:** Digitar t√≠tulo com 1000+ caracteres incluindo men√ß√µes - deve funcionar normalmente
- **Teste Edge 4:** **M√∫ltiplas Men√ß√µes:** `@user1 @user2 #label1 #label2` no mesmo t√≠tulo - todas devem ser processadas
- **Teste Edge 5:** **Cancellation:** Digitar `@` e depois ESC - dropdown deve desaparecer sem adicionar nada
- **Teste Edge 6:** **Keyboard Navigation:** Usar setas para navegar dropdown, Enter para selecionar
- **Teste Edge 7:** **Mobile/Touch:** Testar em dispositivo m√≥vel ou simulador - touch deve funcionar
- **Teste Edge 8:** **Utilizadores Duplicados:** Tentar adicionar o mesmo utilizador duas vezes - deve aparecer apenas uma vez
- **Teste Edge 9:** **Conflito Drag & Drop:** Arrastar arquivo sobre o campo enquanto dropdown est√° aberto
- **Teste Edge 10:** **Concorr√™ncia:** Abrir v√°rias abas e criar cart√µes simultaneamente

### **üéØ TESTES DE INTEGRA√á√ÉO ESPEC√çFICOS:**
- **Teste Int 1:** **Boards com Diferentes Configura√ß√µes:** Testar em board sem utilizadores, board sem labels
- **Teste Int 2:** **Permiss√µes:** Testar com utilizador com permiss√µes limitadas
- **Teste Int 3:** **Browser Compatibility:** Chrome, Firefox, Safari, Edge
- **Teste Int 4:** **Network Issues:** Simular rede lenta durante cria√ß√£o de cart√£o
- **Teste Int 5:** **Undo/Redo:** Testar Ctrl+Z no campo de texto com men√ß√µes
---

### Passo 4: Estrat√©gia de Logs para Debugging (EXPANDIDA)

**‚ö†Ô∏è NOTA:** Os logs devem ser mantidos no c√≥digo at√© que a funcionalidade seja validada e aprovada pelo utilizador [[memory:9198107]].

#### **üìä LOGS ESTRAT√âGICOS OBRIGAT√ìRIOS:**

**1. üèóÔ∏è Logs de Inicializa√ß√£o:**
```javascript
console.log('üöÄ AddCard: Dados Redux carregados:', {
  boardMemberships: boardMemberships.length,
  labels: labels.length,
  usersData: usersData.length,
  labelsData: labelsData.length
});
```

**2. üí¨ Logs do Sistema de Mentions:**
```javascript
console.log('üîç Dropdown apareceu:', { trigger, query, suggestions: data.length });
console.log('‚úÖ Item selecionado:', { type: trigger, id, display, position: {startPos, endPos} });
console.log('üßπ Texto limpo:', { antes: oldValue, depois: newPlainTextValue });
```

**3. üé® Logs dos Previews:**
```javascript
console.log('üë• Utilizadores preview atualizados:', usersToAdd);
console.log('üè∑Ô∏è Labels preview atualizados:', labelsToAdd);
console.log('üîÑ Render preview triggered:', { usersCount: usersToAdd.length, labelsCount: labelsToAdd.length });
```

**4. üöÄ Logs de Submiss√£o:**
```javascript
console.log('üì§ Submiss√£o iniciada:', { 
  cardName: cleanData.name, 
  usersToAdd: usersToAdd.length, 
  labelsToAdd: labelsToAdd.length 
});
console.log('‚ö° Saga createCard chamada:', { cardData: cleanData, userIds: usersToAdd, labelIds: labelsToAdd });
```

**5. üêõ Logs de Debugging Cr√≠ticos:**
```javascript
console.log('‚ö†Ô∏è Dropdown z-index check:', window.getComputedStyle(dropdownElement).zIndex);
console.log('üîß useForm integration:', { formValue: data.name, mentionsValue: newPlainTextValue });
console.log('üéØ Performance check - render time:', performance.now() - renderStart);
```

#### **üìç LOCALIZA√á√ÉO DOS LOGS:**
- **Inicializa√ß√£o:** No `useEffect` que carrega dados Redux
- **Mentions:** Nos callbacks `onAdd`, `onChange`, e `renderSuggestion`
- **Previews:** No render dos componentes de preview
- **Submiss√£o:** Na fun√ß√£o `submit` e antes de chamar `onCreate`
- **Performance:** Em componentes que renderizam listas grandes

### Passo 5: Pontos de Aten√ß√£o e Erros Comuns a Evitar

#### ‚ö†Ô∏è **Problemas Espec√≠ficos do `react-mentions`:**

- **Incompatibilidade de `ref`:** Utilizar `useRef` do React em vez de `useNestedRef` se surgirem problemas.
- **Incompatibilidade com `useForm`:** Adaptar o `onChange` do `MentionsInput` para passar os dados no formato que o `useForm` espera.
- **Gest√£o de `ref` com `useClickAwayListener`:** Garantir que as refer√™ncias s√£o geridas corretamente para evitar erros.
- **Integra√ß√£o com sistema existente:** Garantir que a nova funcionalidade n√£o quebra o sistema atual de cria√ß√£o/edi√ß√£o de cart√µes.

#### üîß **Problemas T√©cnicos Espec√≠ficos do `react-mentions`:**

- **`onChange` callback:** O `MentionsInput` passa 4 par√¢metros: `(event, newValue, newPlainTextValue, mentions)`. Usar `newPlainTextValue` para o valor limpo.
- **Limpeza de texto:** Ap√≥s `onAdd`, remover manualmente o texto da men√ß√£o do campo usando `newPlainTextValue`.
- **Estiliza√ß√£o:** O `react-mentions` gera classes CSS automaticamente. Usar `className` prop para aplicar estilos customizados.
- **Z-index:** As sugest√µes podem ficar por baixo de outros elementos. Verificar z-index do dropdown.
- **Performance:** Para muitos utilizadores/etiquetas, considerar implementar busca ass√≠ncrona com fun√ß√£o `data`.
- **Acessibilidade:** Usar `a11ySuggestionsListLabel` para melhor suporte a screen readers.

#### ‚ö†Ô∏è **COMPATIBILIDADE COM SISTEMA EXISTENTE:**

- **N√£o modificar a√ß√µes Redux existentes:** As a√ß√µes `addUserToCurrentCard`, `addLabelToCurrentCard`, etc. devem continuar funcionando exatamente como antes.
- **Manter consist√™ncia de dados:** Os utilizadores/etiquetas adicionados via men√ß√µes devem usar as mesmas estruturas de dados que o sistema de edi√ß√£o.
- **N√£o quebrar popups existentes:** Os popups de sele√ß√£o de utilizadores/etiquetas no modal de edi√ß√£o devem continuar funcionando normalmente.
- **Sincroniza√ß√£o de estado:** Garantir que as mudan√ßas feitas via cria√ß√£o (men√ß√µes) e edi√ß√£o (popups) sejam refletidas consistentemente no Redux e na UI.

#### üìù **Exemplo de Integra√ß√£o com `useForm` (baseado na implementa√ß√£o real do Planka):**

```javascript
// ‚ö†Ô∏è IMPORTANTE: Usar exatamente a mesma estrutura do sistema de coment√°rios
const handleFieldChange = useCallback(
  (_, text) => {
    setData({
      text, // Usar diretamente o valor do react-mentions
    });
  },
  [setData]
);

// Para integra√ß√£o com useForm existente (SIMPLIFICADO):
const handleMentionsChange = (event, newValue, newPlainTextValue, mentions) => {
  console.log('üîÑ MentionsInput changed:', { newPlainTextValue, mentions });
  
  // 1. Atualizar campo de texto (simples)
  handleFieldChange({
    target: {
      name: 'name',
      value: newPlainTextValue
    }
  });
  
  // 2. Processar apenas mentions NOVAS (evitar duplicatas)
  // NOTA: L√≥gica de onAdd j√° cuida da adi√ß√£o - aqui s√≥ sincronizamos
};

// Callbacks separados e simples:
const handleUserAdd = useCallback((id, display) => {
  console.log('üë• Utilizador adicionado:', { id, display });
  setUsersToAdd(prev => prev.includes(id) ? prev : [...prev, id]);
}, []);

const handleLabelAdd = useCallback((id, display) => {
  console.log('üè∑Ô∏è Label adicionada:', { id, display });
  setLabelsToAdd(prev => prev.includes(id) ? prev : [...prev, id]);
}, []);
```

### Passo 6: Estrat√©gia de Rollback e Conting√™ncia

#### **üö® PLANO DE CONTING√äNCIA (OBRIGAT√ìRIO):**

**1. üíæ Checkpoints de Backup:**
- **Antes Fase 1:** `git stash push -m "backup-antes-mentions-feature"`
- **Ap√≥s Fase 2:** `git commit -m "estrutura-basica-previews"`
- **Ap√≥s Fase 4:** `git commit -m "mentions-funcional-sem-styling"`
- **Antes Saga:** `git commit -m "antes-modificacao-saga"`

**2. üîÑ Estrat√©gias de Rollback R√°pido:**
```bash
# Se algo correr mal durante implementa√ß√£o:
git stash  # Guarda trabalho atual
git reset --hard HEAD~1  # Volta ao √∫ltimo checkpoint

# Se problema for s√≥ CSS:
git checkout HEAD -- src/styles.module.scss
git checkout HEAD -- src/components/cards/AddCard/AddCard.module.scss

# Se problema for s√≥ no componente:
git checkout HEAD -- src/components/cards/AddCard/AddCard.jsx
```

**3. üõ°Ô∏è Prote√ß√µes Durante Implementa√ß√£o:**
- **Nunca modificar** a√ß√µes Redux existentes (`addUserToCurrentCard`, etc.)
- **Nunca tocar** em `NameField.jsx` (edi√ß√£o de cart√µes)
- **Testar cada checkpoint** antes de continuar
- **Manter funcionalidade existente** sempre funcional

**4. üö© Sinais de Alerta (PARAR IMEDIATAMENTE):**
- Sistema de cria√ß√£o de cart√µes normais para de funcionar
- Modal de edi√ß√£o de cart√µes fica quebrado
- Drag & drop de ficheiros para de funcionar
- Performance geral do board degradada significativamente
- Console com mais de 10 erros por opera√ß√£o

**5. üìû Plano B (Se Implementa√ß√£o Falhar):**
- **Op√ß√£o 1:** Implementar apenas previews (sem mentions)
- **Op√ß√£o 2:** Implementar apenas mentions (sem previews)
- **Op√ß√£o 3:** Usar modal simples em vez de inline mentions
- **Op√ß√£o 4:** Adiar feature e investigar alternativas

### Passo 7: Verifica√ß√£o Manual (Utilizador)
- **A√ß√£o:** O utilizador ir√° testar a funcionalidade manualmente para garantir que todos os requisitos foram cumpridos.
- **Resultado Esperado:** A funcionalidade de men√ß√µes funciona como esperado na cria√ß√£o de cart√µes.
- **‚ö†Ô∏è ROLLBACK:** Se qualquer teste falhar criticamente, usar estrat√©gia de rollback apropriada.

## üìã **RESUMO DO QUE PRECISA SER IMPLEMENTADO**

### ‚úÖ **J√° existe (n√£o precisa implementar):**
- Sistema de `react-mentions` nos coment√°rios (refer√™ncia)
- A√ß√µes `addUserToCurrentCard` e `addLabelToCurrentCard`
- Sagas para adicionar utilizadores/etiquetas a cart√µes existentes

### üî® **Precisa ser implementado (APENAS para cria√ß√£o):**
1. **AddCard.jsx:**
   - Implementar `usersToAdd` e `labelsToAdd` no estado
   - Substituir `TextareaAutosize` por `MentionsInput`
   - Implementar sistema de preview
   - Modificar l√≥gica de submiss√£o
   - Aplicar tema glass effect

2. **Saga createCard (ESPECIFICA√á√ÉO DETALHADA):**
   
   **üìç Localiza√ß√£o:** `client/src/sagas/cards.js` - fun√ß√£o `createCard`
   
   **üîß Modifica√ß√£o Necess√°ria:**
   ```javascript
   // ANTES (atual):
   function* createCard(data) {
     const card = yield call(api.createCard, data);
     // ... resto da l√≥gica
   }
   
   // DEPOIS (com mentions):
   function* createCard(data, userIds = [], labelIds = []) {
     console.log('‚ö° createCard saga:', { data, userIds, labelIds });
     
     // 1. Criar cart√£o normalmente
     const card = yield call(api.createCard, data);
     
     // 2. Adicionar utilizadores (se existirem)
     if (userIds.length > 0) {
       for (const userId of userIds) {
         console.log('üë• Adicionando user ao cart√£o:', { cardId: card.id, userId });
         yield put(entryActions.addUserToCard(card.id, userId));
       }
     }
     
     // 3. Adicionar labels (se existirem)
     if (labelIds.length > 0) {
       for (const labelId of labelIds) {
         console.log('üè∑Ô∏è Adicionando label ao cart√£o:', { cardId: card.id, labelId });
         yield put(entryActions.addLabelToCard(card.id, labelId));
       }
     }
     
     // ... resto da l√≥gica original
   }
   ```
   
   **‚ö†Ô∏è IMPORTANTE:** 
   - Usar a√ß√µes `addUserToCard` e `addLabelToCard` (N√ÉO as de currentCard)
   - Manter toda a l√≥gica original da saga
   - Apenas ADICIONAR a nova funcionalidade no final

### ‚ùå **N√ÉO ser√° implementado:**
- **NameField.jsx (edi√ß√£o):** Manter√° o sistema atual sem modifica√ß√µes
- **Modal de edi√ß√£o:** N√£o ter√° funcionalidade de men√ß√µes

### ‚úÖ **FUNCIONALIDADES EXISTENTES QUE DEVEM CONTINUAR A FUNCIONAR:**

**1. Adicionar Utilizadores a Cart√µes Existentes:**
- ‚úÖ **Bot√£o "Membros" no modal de edi√ß√£o** - deve continuar a funcionar normalmente
- ‚úÖ **A√ß√µes `addUserToCurrentCard` e `removeUserFromCurrentCard`** - devem continuar funcionais
- ‚úÖ **Sistema de popup de sele√ß√£o de utilizadores** - deve manter toda a funcionalidade

**2. Adicionar Etiquetas a Cart√µes Existentes:**
- ‚úÖ **Bot√£o "Etiquetas" no modal de edi√ß√£o** - deve continuar a funcionar normalmente
- ‚úÖ **A√ß√µes `addLabelToCurrentCard` e `removeLabelFromCurrentCard`** - devem continuar funcionais
- ‚úÖ **Sistema de popup de sele√ß√£o de etiquetas** - deve manter toda a funcionalidade

**3. Compatibilidade e Sintonia:**
- ‚úÖ **Cart√µes criados com men√ß√µes** devem ter os mesmos utilizadores/etiquetas que aparecem nos bot√µes de edi√ß√£o
- ‚úÖ **Utilizadores/etiquetas adicionados via edi√ß√£o** devem aparecer normalmente nos cart√µes
- ‚úÖ **Sistema de preview** deve ser consistente entre cria√ß√£o e edi√ß√£o
- ‚úÖ **A√ß√µes Redux** devem funcionar identicamente para ambos os fluxos

---

## ‚úÖ **APIS CORRETAS DESCOBERTAS DURANTE IMPLEMENTA√á√ÉO**

### üîß **APIs Funcionais (Testadas e Aprovadas):**

**Para Utilizadores:**
```javascript
// Action
yield put(actions.addUserToCard(userId, cardId, false));

// API Call  
const membership = yield call(request, api.createCardMembership, cardId, { userId });

// Success
yield put(actions.addUserToCard.success(membership.item));
```

**Para Etiquetas:**
```javascript
// Action
yield put(actions.addLabelToCard(labelId, cardId));

// API Call
const cardLabel = yield call(request, api.createCardLabel, cardId, { labelId });

// Success
yield put(actions.addLabelToCard.success(cardLabel.item));
```

### ‚ùå **APIs que N√ÉO existem (evitar):**
- ~~`actions.createCardMembership`~~ ‚Üí Use `actions.addUserToCard`
- ~~`api.addLabelToCard`~~ ‚Üí Use `api.createCardLabel`

---

## üéØ **ESPECIFICA√á√ÉO T√âCNICA EXATA: POSICIONAMENTO DOS PREVIEWS**

### üìç **Localiza√ß√£o no AddCard.jsx (Linha 264-274):**

**ESTRUTURA ATUAL:**
```jsx
<div className={classNames(
  styles.fieldWrapper,
  isDragOver && styles.fieldWrapperDragOver,
  isProcessing && styles.fieldWrapperProcessing
)} ...>
  <TextArea ... />  // ‚Üê Campo de texto atual
  {/* overlays de drag e processing */}
</div>
```

**ESTRUTURA NOVA (com previews):**
```jsx
<div className={classNames(
  styles.fieldWrapper,
  isDragOver && styles.fieldWrapperDragOver,
  isProcessing && styles.fieldWrapperProcessing
)} ...>
  
  {/* üè∑Ô∏è LABELS PREVIEW - TOPO ESQUERDA */}
  {labelsToAdd.length > 0 && (
    <div className={styles.previewLabels}>
      {labelsToAdd.map(labelId => (
        <span key={labelId} className={classNames(styles.previewAttachment, styles.previewAttachmentLeft)}>
          <LabelChip id={labelId} size="tiny" />
        </span>
      ))}
    </div>
  )}
  
  {/* üë• USERS PREVIEW - TOPO DIREITA */}
  {usersToAdd.length > 0 && (
    <div className={classNames(styles.previewAttachments, styles.previewAttachmentsRight)}>
      {usersToAdd.map(userId => (
        <span key={userId} className={classNames(styles.previewAttachment, styles.previewAttachmentRight)}>
          <UserAvatar id={userId} size="small" />
        </span>
      ))}
    </div>
  )}
  
  <MentionsInput ... />  // ‚Üê Campo de texto (substitu√≠do)
  {/* overlays de drag e processing */}
</div>
```

### üé® **Layout Visual Final:**
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [Label1] [Label2] [Label3]              [üë§] [üë§] [üë§]    ‚îÇ ‚Üê Previews
‚îÇ                                                             ‚îÇ
‚îÇ Digite o t√≠tulo do cart√£o...                                ‚îÇ ‚Üê Campo MentionsInput
‚îÇ                                                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**‚ö†Ô∏è IMPORTA√á√ïES NECESS√ÅRIAS:**
- `{ MentionsInput, Mention }` de `'react-mentions'`
- `LabelChip` de `'../../../components/ui/'`
- `UserAvatar` de `'../../../components/ui/'`
- `classNames` (j√° importado)
- `useCallback` de `'react'` (para callbacks otimizados)
- `useMemo` de `'react'` (para otimiza√ß√£o de listas)
- Seletores Redux: `selectors.selectMembershipsForCurrentBoard`, `selectors.selectLabelsForCurrentBoard`

**‚ö†Ô∏è ORDEM DE IMPLEMENTA√á√ÉO CORRIGIDA (COM CHECKPOINTS):**

### **üîß FASE 1: PREPARA√á√ÉO E BACKUP**
1. **Backup:** Criar branch ou `git stash` do estado atual
2. **Importa√ß√µes:** Adicionar todas as importa√ß√µes necess√°rias (`MentionsInput`, `Mention`, etc.)
3. **‚úÖ CHECKPOINT 1:** Verificar que projeto ainda compila

### **üèóÔ∏è FASE 2: ESTRUTURA B√ÅSICA**
4. **Estados:** Adicionar `usersToAdd` e `labelsToAdd` no estado local
5. **CSS Previews:** Adicionar classes CSS de preview ao `AddCard.module.scss`
6. **HTML Previews:** Implementar HTML de previews (vazios inicialmente)
7. **‚úÖ CHECKPOINT 2:** Verificar que previews aparecem vazios e layout n√£o quebrou

### **üîå FASE 3: FUNCIONALIDADE B√ÅSICA**
8. **MentionsInput B√°sico:** Substituir `TextArea` por `MentionsInput` (sem mentions ainda)
9. **Integra√ß√£o useForm:** Garantir que campo continua a funcionar como texto normal
10. **‚úÖ CHECKPOINT 3:** Verificar que campo de texto funciona normalmente

### **üí¨ FASE 4: SISTEMA DE MENTIONS**
11. **Dados Redux:** Conectar utilizadores e labels do Redux
12. **Mentions Config:** Adicionar triggers, data, callbacks b√°sicos
13. **Dropdown B√°sico:** Verificar que dropdown aparece (sem estilo glass ainda)
14. **‚úÖ CHECKPOINT 4:** Verificar que dropdown de mentions aparece e funciona

### **üé® FASE 5: L√ìGICA DE PREVIEWS**
15. **Callbacks onAdd:** Implementar adi√ß√£o de items aos arrays
16. **Limpeza de Texto:** Implementar remo√ß√£o de texto de men√ß√£o
17. **Rendering Previews:** Conectar arrays aos componentes de preview
18. **‚úÖ CHECKPOINT 5:** Verificar que previews funcionam completamente

### **‚ú® FASE 6: POLIMENTO E ESTILO**
19. **Glass Theme:** Aplicar estilos glass theme ao dropdown
20. **Otimiza√ß√µes:** Adicionar `useMemo` e `useCallback` onde necess√°rio
21. **‚úÖ CHECKPOINT 6:** Verificar tema glass e performance

### **üöÄ FASE 7: INTEGRA√á√ÉO FINAL**
22. **Saga Modification:** Modificar saga `createCard` para processar arrays
23. **Testes Finais:** Executar todos os testes manuais
24. **‚úÖ CHECKPOINT FINAL:** Valida√ß√£o completa da funcionalidade
